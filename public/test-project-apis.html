<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Project APIs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        input, select, textarea {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .project-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
        }
        .project-item {
            padding: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .project-item:last-child {
            border-bottom: none;
        }
        .form-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 5px 0;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Project Management API Test</h1>
        <p>This page allows you to test all project management APIs including CRUD operations.</p>

        <!-- List Projects -->
        <div class="section">
            <h3>1. List All Projects</h3>
            <button onclick="listProjects()">Fetch Projects</button>
            <div id="projects-result" class="result"></div>
            <div id="projects-list" class="project-list" style="display: none;"></div>
        </div>

        <!-- Create Project -->
        <div class="section">
            <h3>2. Create New Project</h3>
            <div class="form-group">
                <div class="form-row">
                    <input type="text" id="create-name" placeholder="Project Name *" style="width: 200px;">
                    <input type="text" id="create-client" placeholder="Client Name" style="width: 200px;">
                </div>
                <div class="form-row">
                    <textarea id="create-description" placeholder="Project Description" rows="2" style="width: 420px;"></textarea>
                </div>
                <div class="form-row">
                    <input type="text" id="create-github" placeholder="GitHub URL" style="width: 300px;">
                    <input type="text" id="create-tech" placeholder="Tech Stack" style="width: 200px;">
                </div>
                <div class="form-row">
                    <select id="create-status" style="width: 150px;">
                        <option value="OnTrack">On Track</option>
                        <option value="AtRisk">At Risk</option>
                        <option value="Completed">Completed</option>
                    </select>
                    <input type="date" id="create-start-date" style="width: 150px;">
                    <input type="date" id="create-end-date" style="width: 150px;">
                </div>
            </div>
            <button class="success" onclick="createProject()">Create Project</button>
            <div id="create-result" class="result"></div>
        </div>

        <!-- Edit Project -->
        <div class="section">
            <h3>3. Edit Project</h3>
            <div class="form-group">
                <div class="form-row">
                    <input type="text" id="edit-project-id" placeholder="Project ID *" style="width: 250px;">
                    <button onclick="loadProjectForEdit()">Load Project</button>
                </div>
                <div class="form-row">
                    <input type="text" id="edit-name" placeholder="Project Name *" style="width: 200px;">
                    <input type="text" id="edit-client" placeholder="Client Name" style="width: 200px;">
                </div>
                <div class="form-row">
                    <textarea id="edit-description" placeholder="Project Description" rows="2" style="width: 420px;"></textarea>
                </div>
                <div class="form-row">
                    <input type="text" id="edit-github" placeholder="GitHub URL" style="width: 300px;">
                    <input type="text" id="edit-tech" placeholder="Tech Stack" style="width: 200px;">
                </div>
                <div class="form-row">
                    <select id="edit-status" style="width: 150px;">
                        <option value="OnTrack">On Track</option>
                        <option value="AtRisk">At Risk</option>
                        <option value="Completed">Completed</option>
                    </select>
                    <input type="number" id="edit-progress" placeholder="Progress %" min="0" max="100" style="width: 100px;">
                </div>
                <div class="form-row">
                    <input type="date" id="edit-start-date" style="width: 150px;">
                    <input type="date" id="edit-end-date" style="width: 150px;">
                </div>
            </div>
            <button onclick="editProject()">Update Project</button>
            <div id="edit-result" class="result"></div>
        </div>

        <!-- Delete Single Project -->
        <div class="section">
            <h3>4. Delete Single Project</h3>
            <input type="text" id="delete-project-id" placeholder="Enter Project ID" style="width: 300px;">
            <button class="danger" onclick="deleteProject()">Delete Project</button>
            <div id="delete-result" class="result"></div>
        </div>

        <!-- Bulk Project Deletion -->
        <div class="section">
            <h3>5. Bulk Delete Projects</h3>
            <input type="text" id="bulk-project-ids" placeholder="Enter Project IDs (comma-separated)" style="width: 400px;">
            <button class="danger" onclick="bulkDeleteProjects()">Bulk Delete Projects</button>
            <div id="bulk-delete-result" class="result"></div>
        </div>

        <!-- Archive Project -->
        <div class="section">
            <h3>6. Archive/Unarchive Project</h3>
            <div class="form-row">
                <input type="text" id="archive-project-id" placeholder="Enter Project ID" style="width: 200px;">
                <input type="text" id="archive-reason" placeholder="Archive reason" style="width: 200px;">
            </div>
            <button onclick="archiveProject()">Archive Project</button>
            <button onclick="unarchiveProject()">Unarchive Project</button>
            <div id="archive-result" class="result"></div>
        </div>
    </div>

    <script>
        let currentProjects = [];

        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function listProjects() {
            const result = await makeRequest('/api/projects');
            const resultDiv = document.getElementById('projects-result');
            const listDiv = document.getElementById('projects-list');
            
            if (result.success) {
                currentProjects = result.data;
                resultDiv.className = 'result success';
                resultDiv.textContent = `Found ${currentProjects.length} projects`;
                
                listDiv.innerHTML = '';
                currentProjects.forEach(project => {
                    const item = document.createElement('div');
                    item.className = 'project-item';
                    item.innerHTML = `
                        <div>
                            <strong>${project.name}</strong> (${project.id})
                            <br><small>Status: ${project.status}, Progress: ${project.progress}%, Client: ${project.clientName || 'N/A'}</small>
                        </div>
                        <div>
                            <button onclick="fillProjectId('${project.id}')">Use ID</button>
                            <button onclick="loadProjectForEditById('${project.id}')">Load for Edit</button>
                        </div>
                    `;
                    listDiv.appendChild(item);
                });
                listDiv.style.display = 'block';
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${result.error || result.data?.error || 'Failed to fetch projects'}`;
                listDiv.style.display = 'none';
            }
        }

        function fillProjectId(projectId) {
            document.getElementById('delete-project-id').value = projectId;
            document.getElementById('archive-project-id').value = projectId;
            document.getElementById('edit-project-id').value = projectId;
        }

        async function createProject() {
            const projectData = {
                name: document.getElementById('create-name').value.trim(),
                clientName: document.getElementById('create-client').value.trim(),
                description: document.getElementById('create-description').value.trim(),
                githubRepo: document.getElementById('create-github').value.trim(),
                techStack: document.getElementById('create-tech').value.trim(),
                status: document.getElementById('create-status').value,
                startDate: document.getElementById('create-start-date').value || undefined,
                endDate: document.getElementById('create-end-date').value || undefined,
            };

            if (!projectData.name) {
                alert('Project name is required');
                return;
            }

            const result = await makeRequest('/api/projects', {
                method: 'POST',
                body: JSON.stringify(projectData)
            });
            
            const resultDiv = document.getElementById('create-result');
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(result.data, null, 2);
                // Clear form
                document.getElementById('create-name').value = '';
                document.getElementById('create-client').value = '';
                document.getElementById('create-description').value = '';
                document.getElementById('create-github').value = '';
                document.getElementById('create-tech').value = '';
                document.getElementById('create-start-date').value = '';
                document.getElementById('create-end-date').value = '';
                // Refresh project list
                setTimeout(listProjects, 1000);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${result.error || result.data?.error || 'Failed to create project'}`;
            }
        }

        async function loadProjectForEdit() {
            const projectId = document.getElementById('edit-project-id').value.trim();
            if (!projectId) {
                alert('Please enter a project ID');
                return;
            }
            loadProjectForEditById(projectId);
        }

        async function loadProjectForEditById(projectId) {
            const project = currentProjects.find(p => p.id === projectId);
            if (project) {
                document.getElementById('edit-project-id').value = project.id;
                document.getElementById('edit-name').value = project.name;
                document.getElementById('edit-client').value = project.clientName || '';
                document.getElementById('edit-description').value = project.description || '';
                document.getElementById('edit-github').value = project.githubRepo || '';
                document.getElementById('edit-tech').value = project.techStack || '';
                document.getElementById('edit-status').value = project.status;
                document.getElementById('edit-progress').value = project.progress;
                
                if (project.startDate) {
                    document.getElementById('edit-start-date').value = project.startDate.split('T')[0];
                }
                if (project.endDate) {
                    document.getElementById('edit-end-date').value = project.endDate.split('T')[0];
                }
            } else {
                alert('Project not found in current list. Please refresh the project list first.');
            }
        }

        async function editProject() {
            const projectId = document.getElementById('edit-project-id').value.trim();
            const projectData = {
                name: document.getElementById('edit-name').value.trim(),
                clientName: document.getElementById('edit-client').value.trim(),
                description: document.getElementById('edit-description').value.trim(),
                githubRepo: document.getElementById('edit-github').value.trim(),
                techStack: document.getElementById('edit-tech').value.trim(),
                status: document.getElementById('edit-status').value,
                progress: parseInt(document.getElementById('edit-progress').value) || 0,
                startDate: document.getElementById('edit-start-date').value || undefined,
                endDate: document.getElementById('edit-end-date').value || undefined,
            };

            if (!projectId || !projectData.name) {
                alert('Project ID and name are required');
                return;
            }

            const result = await makeRequest(`/api/projects/${projectId}`, {
                method: 'PUT',
                body: JSON.stringify(projectData)
            });
            
            const resultDiv = document.getElementById('edit-result');
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(result.data, null, 2);
                // Refresh project list
                setTimeout(listProjects, 1000);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${result.error || result.data?.error || 'Failed to update project'}`;
            }
        }

        async function deleteProject() {
            const projectId = document.getElementById('delete-project-id').value.trim();
            if (!projectId) {
                alert('Please enter a project ID');
                return;
            }

            if (!confirm(`Are you sure you want to delete project ${projectId}? This action cannot be undone.`)) {
                return;
            }

            const result = await makeRequest(`/api/projects/${projectId}`, {
                method: 'DELETE'
            });
            
            const resultDiv = document.getElementById('delete-result');
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(result.data, null, 2);
                // Refresh project list
                setTimeout(listProjects, 1000);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${result.error || result.data?.error || 'Failed to delete project'}`;
            }
        }

        async function bulkDeleteProjects() {
            const projectIds = document.getElementById('bulk-project-ids').value.trim();
            if (!projectIds) {
                alert('Please enter project IDs (comma-separated)');
                return;
            }

            const idsArray = projectIds.split(',').map(id => id.trim()).filter(id => id);
            if (idsArray.length === 0) {
                alert('Please enter valid project IDs');
                return;
            }

            if (!confirm(`Are you sure you want to delete ${idsArray.length} projects? This action cannot be undone.`)) {
                return;
            }

            const result = await makeRequest('/api/projects/bulk-delete', {
                method: 'POST',
                body: JSON.stringify({ projectIds: idsArray })
            });
            
            const resultDiv = document.getElementById('bulk-delete-result');
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(result.data, null, 2);
                // Refresh project list
                setTimeout(listProjects, 1000);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${result.error || result.data?.error || 'Failed to bulk delete projects'}`;
            }
        }

        async function archiveProject() {
            const projectId = document.getElementById('archive-project-id').value.trim();
            const reason = document.getElementById('archive-reason').value.trim();
            
            if (!projectId) {
                alert('Please enter a project ID');
                return;
            }

            const result = await makeRequest(`/api/projects/${projectId}/archive`, {
                method: 'POST',
                body: JSON.stringify({ reason: reason || 'No reason provided' })
            });
            
            const resultDiv = document.getElementById('archive-result');
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(result.data, null, 2);
                // Refresh project list
                setTimeout(listProjects, 1000);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${result.error || result.data?.error || 'Failed to archive project'}`;
            }
        }

        async function unarchiveProject() {
            const projectId = document.getElementById('archive-project-id').value.trim();
            
            if (!projectId) {
                alert('Please enter a project ID');
                return;
            }

            const result = await makeRequest(`/api/projects/${projectId}/archive`, {
                method: 'DELETE'
            });
            
            const resultDiv = document.getElementById('archive-result');
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = JSON.stringify(result.data, null, 2);
                // Refresh project list
                setTimeout(listProjects, 1000);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `Error: ${result.error || result.data?.error || 'Failed to unarchive project'}`;
            }
        }

        // Auto-load projects on page load
        window.onload = function() {
            listProjects();
        };
    </script>
</body>
</html>