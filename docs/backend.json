{
  "entities": {
    "Employee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Employee",
      "type": "object",
      "description": "Represents an employee within the company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the employee."
        },
        "name": {
          "type": "string",
          "description": "Full name of the employee."
        },
        "email": {
          "type": "string",
          "description": "Email address of the employee.",
          "format": "email"
        },
        "enrollmentDate": {
          "type": "string",
          "description": "Date when the employee was enrolled.",
          "format": "date-time"
        },
        "roleIds": {
          "type": "array",
          "description": "References to Roles. (Relationship: Employee N:N Role)",
          "items": {
            "type": "string"
          }
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Employee)"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "enrollmentDate",
        "projectId"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a project within the company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project."
        },
        "name": {
          "type": "string",
          "description": "Name of the project."
        },
        "description": {
          "type": "string",
          "description": "Description of the project."
        },
        "startDate": {
          "type": "string",
          "description": "Date when the project started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the project is expected to end.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "startDate",
        "endDate"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task assigned to an employee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task."
        },
        "name": {
          "type": "string",
          "description": "Name of the task."
        },
        "description": {
          "type": "string",
          "description": "Description of the task."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to Employee. (Relationship: Employee 1:N Task)"
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Task)"
        },
        "dueDate": {
          "type": "string",
          "description": "Date when the task is due.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the task (e.g., 'To Do', 'In Progress', 'Completed')."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "employeeId",
        "projectId",
        "dueDate",
        "status"
      ]
    },
    "Attendance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance",
      "type": "object",
      "description": "Represents an employee's attendance record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the attendance record."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to Employee. (Relationship: Employee 1:N Attendance)"
        },
        "date": {
          "type": "string",
          "description": "Date of the attendance record.",
          "format": "date-time"
        },
        "checkInTime": {
          "type": "string",
          "description": "Time when the employee checked in.",
          "format": "date-time"
        },
        "checkOutTime": {
          "type": "string",
          "description": "Time when the employee checked out.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "employeeId",
        "date",
        "checkInTime"
      ]
    },
    "LeaveRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaveRequest",
      "type": "object",
      "description": "Represents a leave request from an employee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leave request."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to Employee. (Relationship: Employee 1:N LeaveRequest)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the leave.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the leave.",
          "format": "date-time"
        },
        "reason": {
          "type": "string",
          "description": "Reason for the leave request."
        },
        "status": {
          "type": "string",
          "description": "Status of the leave request (e.g., 'Pending', 'Approved', 'Rejected')."
        }
      },
      "required": [
        "id",
        "employeeId",
        "startDate",
        "endDate",
        "reason",
        "status"
      ]
    },
    "Role": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Role",
      "type": "object",
      "description": "Represents a role within the company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the role."
        },
        "name": {
          "type": "string",
          "description": "Name of the role (e.g., 'Developer', 'Manager')."
        },
        "description": {
          "type": "string",
          "description": "Description of the role."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/employees/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores employee profiles. Includes standard employee information.",
          "params": [
            {
              "name": "employeeId",
              "description": "Unique identifier for the employee."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores project details.",
          "params": [
            {
              "name": "projectId",
              "description": "Unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/employees/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores employees within a specific project.  Includes denormalized 'projectId' field for authorization independence.",
          "params": [
            {
              "name": "projectId",
              "description": "Unique identifier for the project."
            },
            {
              "name": "employeeId",
              "description": "Unique identifier for the employee."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks assigned to employees. Includes 'employeeId' and 'projectId' fields for task assignment and project association.",
          "params": [
            {
              "name": "taskId",
              "description": "Unique identifier for the task."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}/attendance/{attendanceId}",
        "definition": {
          "entityName": "Attendance",
          "schema": {
            "$ref": "#/backend/entities/Attendance"
          },
          "description": "Stores attendance records for each employee.",
          "params": [
            {
              "name": "employeeId",
              "description": "Unique identifier for the employee."
            },
            {
              "name": "attendanceId",
              "description": "Unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}/leaveRequests/{leaveRequestId}",
        "definition": {
          "entityName": "LeaveRequest",
          "schema": {
            "$ref": "#/backend/entities/LeaveRequest"
          },
          "description": "Stores leave requests submitted by employees.",
          "params": [
            {
              "name": "employeeId",
              "description": "Unique identifier for the employee."
            },
            {
              "name": "leaveRequestId",
              "description": "Unique identifier for the leave request."
            }
          ]
        }
      },
      {
        "path": "/roles/{roleId}",
        "definition": {
          "entityName": "Role",
          "schema": {
            "$ref": "#/backend/entities/Role"
          },
          "description": "Stores role definitions.",
          "params": [
            {
              "name": "roleId",
              "description": "Unique identifier for the role."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage employee, project, task, attendance, leave request, and role data for CompanyFlow, a project management application. It prioritizes authorization independence, clarity, and scalability. Authorization independence is achieved through denormalization. For example, the `employees` subcollection within `projects` includes denormalized role information. This avoids the need for `get()` calls in security rules, simplifying rule creation and maintenance, as well as enabling atomic operations. The structure also segregates data based on access requirements, with dedicated collections for each entity type. This allows for simple and robust security rules that are easy to debug. Global roles are managed using a dedicated collection (`/roles/{roleId}`), allowing for easy assignment of roles to users.  The chosen structure supports QAPs by ensuring secure list operations. For example, listing employees within a project can be secured by checking if the user has access to the project via the project's members map.  The path-based ownership model (`/employees/{employeeId}/attendance/{attendanceId}`) provides a clear ownership structure for private user data like attendance and leave requests."
  }
}